!function(e){var n=void 0,t=void 0,o=void 0,l=void 0;e.fn.extend({getDefaultAccountingNumber:function(){var n=e("#accountingOperations").find("#DefaultAccountingNumber").val();return null==n||0===n.length?null:parseInt(n)},getUrlForDefaultAccountingNumber:function(){var n=e("#accountingOperations").find("#DefaultAccountingNumber").parent().data("url");return null==n||0===n.length?null:n},getActiveAccountingNumber:function(){var n=e("#loadedAccountingCollection").children("[data-accounting-number]");if(0===n.length)return null;var t=null;return e.each(n,function(){e(this).hasClass("active")&&null===t&&(t=parseInt(e(this).data("accounting-number")))}),t},getActiveOrDefaultAccountingNumber:function(){var n=e().getActiveAccountingNumber();return null!=n?n:e().getDefaultAccountingNumber()},newAccounting:function(n){var t=e().getPresentAccountingElement();null!==t&&(e(t).data("url",encodeURI(n)),e.each(e(t).parent(),function(){e().startPresentingAccountingObserver(this)}),e().replaceWithPartialViewFromUrl(t))},getAccounting:function(n){var t=e().getPresentAccountingElement();null!==t&&(e(t).data("url",encodeURI(n)),e.each(e(t).parent(),function(){e().startPresentingAccountingObserver(this)}),e().replaceWithPartialViewFromUrl(t))},editAccounting:function(){e().isDisplayed("#editAccounting")||(e().toggleDisplay("#presentAccounting"),e().toggleDisplay("#editAccounting"))},cancelEditAccounting:function(){0!==e("#editAccounting").length?!1!==e().isDisplayed("#editAccounting")&&(e().toggleDisplay("#editAccounting"),e().toggleDisplay("#presentAccounting")):e("#editAccountingForm").remove()},refreshAccountings:function(n){if(0!==e("#loadedAccountingCollection").length){var t=e().getActiveOrDefaultAccountingNumber(),o=decodeURI(n);o=null==t?o.substr(0,o.indexOf("?")):o.replace("{accountingNumber}",t),e().startLoadingAccountings(encodeURI(o))}},newAccount:function(n){e().startAccountPresentation(n)},editAccount:function(n){e().startAccountPresentation(n)},startLoadingAccountings:function(n){e.each(e("#accountingCollection"),function(){e().startAccountingCollectionObserver(this),e.each(e(this).children("#loadedAccountingCollection"),function(){e(this).data("url",n),e().replaceWithPartialViewFromUrl(this)})})},startAccountingCollectionObserver:function(n){new MutationObserver(e().accountingCollectionCallback).observe(n,{childList:!0})},accountingCollectionCallback:function(n,t){if(0!==n.length){var o=e(n[0].target).find("#loadedAccountingCollection");if(0!==o.length){t.disconnect();var l=e().isRightContentHidden();e.each(o,function(){e.each(e(this).find("a"),function(){!0===l&&e(this).hasClass("active")&&e(this).removeClass("active"),e(this).on("click",function(n){n.preventDefault(),e(this).tab("show")}),e(this).on("shown.bs.tab",function(n){e().getAccounting(e(n.target).data("url"))})})})}else e().handleUrlInstantLoading(e(document))}},isRightContentHidden:function(){return e("#rightContent").is(":hidden")},getPresentAccountingElement:function(){var n=e("#rightContent");n.is(":hidden")&&(n=e("#leftContent"));var t=null,o=0;return e.each(e(n).children("div"),function(){0===o?(t=e(this),o++):e(this).remove()}),t},startPresentingAccountingObserver:function(n){new MutationObserver(e().presentingAccountingCallback).observe(n,{childList:!0})},presentingAccountingCallback:function(n,t){if(0!==n.length){var o=e(n[0].target).find("[data-url]");if(0===o.length)return t.disconnect(),e().enableDataPickers(),e().enableFormValidation("#editAccountingForm"),void e().enableFormValidation("#addPostingLineToPostingJournalForm");e.each(o,function(){e().replaceWithPartialViewFromUrl(this)})}},startAccountPresentation:function(n){var t=e().getPresentAccountingElement();null!==t&&(e(t).data("url",encodeURI(n)),e.each(e(t).parent(),function(){e().startAccountPresentationObserver(this)}),e().replaceWithPartialViewFromUrl(t))},startAccountPresentationObserver:function(n){new MutationObserver(e().accountPresentationCallback).observe(n,{childList:!0})},accountPresentationCallback:function(n,t){if(0!==n.length){var o=e(n[0].target).find("[data-url]");if(0===o.length)return t.disconnect(),void e().enableFormValidation("#editAccountForm");e.each(o,function(){e().replaceWithPartialViewFromUrl(this)})}},startAddingToPostingJournal:function(){e("#addPostingLineToPostingJournalModal").modal("show")},addToPostingJournal:function(n,t,o,l,i,a,r,c,u,s,g,d,v){var f=function(n){e().setReadOnly(o,n),e().setDisabled(o,n),e().setReadOnly(l,n),e().setDisabled(l,n),e().setReadOnly(i,n),e().setDisabled(i,n),e().setReadOnly(a,n),e().setDisabled(a,n),e().setReadOnly(r,n),e().setDisabled(r,n),e().setReadOnly(c,n),e().setDisabled(c,n),e().setReadOnly(u,n),e().setDisabled(u,n),e().setReadOnly(s,n),e().setDisabled(s,n),e().setDisabled("#addToPostingJournalButton",n)};f(!0);var m=e().getValidator(e("#addPostingLineToPostingJournalForm"));if(m.numberOfInvalids()>0)return m.showErrors(),void f(!1);v.postingLine=JSON.stringify({Identifier:e().resolveElementValue(t),PostingDate:e().resolvePostingDateAsISOString(o),Reference:e().resolveElementValue(l),AccountNumber:e().resolveAccountNumber(i),Details:e().resolveElementValue(a),BudgetAccountNumber:e().resolveAccountNumber(r),Debit:e().resolvePostingValue(c),Credit:e().resolvePostingValue(u),ContactAccountNumber:e().resolveAccountNumber(s),SortOrder:e().resolveSortOrder(g)}),v.postingJournalHeader=e().resolveElementText(n),e.post(d,v,null,"html").done(function(n){f(!1),e("#addPostingLineToPostingJournalModal").on("hidden.bs.modal",function(){e().replacePostingJournal(e("#postingJournal"),n)}),e("#addPostingLineToPostingJournalModal").modal("hide")}).fail(function(n,t,o){f(!1),alert(e().getErrorMessage(n,t,o))})},removeFromPostingJournal:function(n,t,o,l){e(n).data("disabled")||(e().disableChildLinkElements("#postingJournal",!0),l.postingJournalHeader=e().resolveElementText(t),e.post(o,l,null,"html").done(function(n){e().disableChildLinkElements("#postingJournal",!1),e().replacePostingJournal(e("#postingJournal"),n)}).fail(function(n,t,o){e().disableChildLinkElements("#postingJournal",!1),alert(e().getErrorMessage(n,t,o))}))},removeFromPostingJournalResult:function(n,t,o){e(n).data("disabled")||(e().disableChildLinkElements("#postingWarnings",!0),e.post(t,o,null,"html").done(function(n){e().disableChildLinkElements("#postingWarnings",!1),e("#postingWarnings").replaceWith(n)}).fail(function(n,t,o){e().disableChildLinkElements("#postingWarnings",!1),alert(e().getErrorMessage(n,t,o))}))},onPostingDataChange:function(t,o,l,i,a,r,c,u,s,g,d,v,f,m,h){void 0!==n&&clearTimeout(n),n=setTimeout(function(){var n=e().resolvePostingDateAsISOString(t),A=e().resolveAccountNumber(o),b=e().resolveAccountNumber(c),p=e().resolveAccountNumber(v);e().resolveAccount(n,A,l,i,a,r),e().resolveBudgetAccount(n,b,u,s,g,d),e().resolveContactAccount(n,p,f,m,h)},500)},onAccountNumberChange:function(n,o,l,i,a,r){void 0!==t&&clearTimeout(t),t=setTimeout(function(){var t=e().resolvePostingDateAsISOString(n),c=e().resolveAccountNumber(o);e().resolveAccount(t,c,l,i,a,r)},500)},resolveAccount:function(n,t,o,l,i,a){e(o).val(""),e(l).val(""),e(i).val(""),null!=n&&0!==n.length&&null!=t&&0!==t.length&&(a=encodeURI(decodeURI(a).replace("{accountNumber}",t).replace("{statusDate}",n)),e.get(a,null,null,"json").done(function(n){e(o).val(n.accountName),e(l).val(e().currencyFormat(n.valuesAtStatusDate.credit)),e(i).val(e().currencyFormat(n.valuesAtStatusDate.available))}))},onBudgetAccountNumberChange:function(n,t,l,i,a,r){void 0!==o&&clearTimeout(o),o=setTimeout(function(){var o=e().resolvePostingDateAsISOString(n),c=e().resolveAccountNumber(t);e().resolveBudgetAccount(o,c,l,i,a,r)},500)},resolveBudgetAccount:function(n,t,o,l,i,a){e(o).val(""),e(l).val(""),e(i).val(""),null!=n&&0!==n.length&&null!=t&&0!==t.length&&(a=encodeURI(decodeURI(a).replace("{accountNumber}",t).replace("{statusDate}",n)),e.get(a,null,null,"json").done(function(n){e(o).val(n.accountName),e(l).val(e().currencyFormat(n.valuesForMonthOfStatusDate.posted)),e(i).val(e().currencyFormat(n.valuesForMonthOfStatusDate.available))}))},onContactAccountNumberChange:function(n,t,o,i,a){void 0!==l&&clearTimeout(l),l=setTimeout(function(){var l=e().resolvePostingDateAsISOString(n),r=e().resolveAccountNumber(t);e().resolveContactAccount(l,r,o,i,a)},500)},resolveContactAccount:function(n,t,o,l,i){e(o).val(""),e(l).val(""),null!=n&&0!==n.length&&null!=t&&0!==t.length&&(i=encodeURI(decodeURI(i).replace("{accountNumber}",t).replace("{statusDate}",n)),e.get(i,null,null,"json").done(function(n){e(o).val(n.accountName),e(l).val(e().currencyFormat(n.valuesAtStatusDate.balance))}))},resolvePostingDateAsISOString:function(n){var t=e().resolvePostingDate(n);return null==t?null:t.toISOString()},resolvePostingDate:function(n){var t=e().resolveElementValue(n);return null==t||0===t.length?null:new RegExp("^(0[1-9]|[12][0-9]|3[01])-(0[1-9]|1[012])-((19|20)[0-9]{2})$").test(t)?new Date(t.substr(6,4),t.substr(3,2)-1,t.substr(0,2)):null},resolveAccountNumber:function(n){var t=e().resolveElementValue(n);return null==t||0===t.length?null:t.toUpperCase()},resolvePostingValue:function(n){var t=e().resolveElementValue(n);if(null==t||0===t.length)return null;var o=(t=t.trim()).replace(/[^0-9]/g,"");return/[,\.]\d{2}$/.test(t)&&(o=o.replace(/(\d{2})$/,".$1")),parseFloat(parseFloat(o).toFixed(2))},resolveSortOrder:function(n){var t=e().resolveElementValue(n);return null==t||0===t.length?null:parseInt(t)},resolveElementValue:function(n){var t=e(n).val();return null==t||0===t.length?null:t},resolveElementText:function(n){var t=e(n).text();return null==t||0===t.length?null:t},currencyFormat:function(e){return"kr. "+e.toFixed(2).replace(".",",").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1.")},replacePostingJournal:function(n,t){e(n).replaceWith(t),e().enableDataPickers(),e().enableFormValidation("#addPostingLineToPostingJournalForm")},enableDataPickers:function(){e(".input-group.date").datepicker({format:"dd-mm-yyyy",clearBtn:!1,todayBtn:!0,language:"da"})}}),e(document).ready(function(){e().startAccountingCollectionObserver(document.getElementById("accountingCollection"));var n=e().getUrlForDefaultAccountingNumber();null!==n&&(e().isRightContentHidden()||e().getAccounting(n))})}(jQuery);