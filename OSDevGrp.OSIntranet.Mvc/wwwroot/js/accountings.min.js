!function(n){var e=void 0,t=void 0,o=void 0,a=void 0;n.fn.extend({getDefaultAccountingNumber:function(){var e=n("#accountingOperations").find("#DefaultAccountingNumber").val();return null==e||0===e.length?null:parseInt(e)},getUrlForDefaultAccountingNumber:function(){var e=n("#accountingOperations").find("#DefaultAccountingNumber").parent().data("url");return null==e||0===e.length?null:e},getActiveAccountingNumber:function(){var e=n("#loadedAccountingCollection").children("[data-accounting-number]");if(0===e.length)return null;var t=null;return n.each(e,function(){n(this).hasClass("active")&&null===t&&(t=parseInt(n(this).data("accounting-number")))}),t},getActiveOrDefaultAccountingNumber:function(){var e=n().getActiveAccountingNumber();return null!=e?e:n().getDefaultAccountingNumber()},newAccounting:function(e){var t=n().getPresentAccountingElement();null!==t&&(n(t).data("url",encodeURI(e)),n.each(n(t).parent(),function(){n().startPresentingAccountingObserver(this)}),n().replaceWithPartialViewFromUrl(t))},getAccounting:function(e){var t=n().getPresentAccountingElement();null!==t&&(n(t).data("url",encodeURI(e)),n.each(n(t).parent(),function(){n().startPresentingAccountingObserver(this)}),n().replaceWithPartialViewFromUrl(t))},editAccounting:function(){n().isDisplayed("#editAccounting")||(n().toggleDisplay("#presentAccounting"),n().toggleDisplay("#editAccounting"))},cancelEditAccounting:function(){0!==n("#editAccounting").length?!1!==n().isDisplayed("#editAccounting")&&(n().toggleDisplay("#editAccounting"),n().toggleDisplay("#presentAccounting")):n("#editAccountingForm").remove()},refreshAccountings:function(e){if(0!==n("#loadedAccountingCollection").length){var t=n().getActiveOrDefaultAccountingNumber(),o=decodeURI(e);o=null==t?o.substr(0,o.indexOf("?")):o.replace("{accountingNumber}",t),n().startLoadingAccountings(encodeURI(o))}},newAccount:function(e){n().startAccountPresentation(e)},editAccount:function(e){n().startAccountPresentation(e)},startLoadingAccountings:function(e){n.each(n("#accountingCollection"),function(){n().startAccountingCollectionObserver(this),n.each(n(this).children("#loadedAccountingCollection"),function(){n(this).data("url",e),n().replaceWithPartialViewFromUrl(this)})})},startAccountingCollectionObserver:function(e){new MutationObserver(n().accountingCollectionCallback).observe(e,{childList:!0})},accountingCollectionCallback:function(e,t){if(0!==e.length){var o=n(e[0].target).find("#loadedAccountingCollection");if(0!==o.length){t.disconnect();var a=n().isRightContentHidden();n.each(o,function(){n.each(n(this).find("a"),function(){!0===a&&n(this).hasClass("active")&&n(this).removeClass("active"),n(this).on("click",function(e){e.preventDefault(),n(this).tab("show")}),n(this).on("shown.bs.tab",function(e){n().getAccounting(n(e.target).data("url"))})})})}else n().handleUrlInstantLoading(n(document))}},isRightContentHidden:function(){return n("#rightContent").is(":hidden")},getPresentAccountingElement:function(){var e=n("#rightContent");e.is(":hidden")&&(e=n("#leftContent"));var t=null,o=0;return n.each(n(e).children("div"),function(){0===o?(t=n(this),o++):n(this).remove()}),t},startPresentingAccountingObserver:function(e){new MutationObserver(n().presentingAccountingCallback).observe(e,{childList:!0})},presentingAccountingCallback:function(e,t){if(0!==e.length){var o=n(e[0].target).find("[data-url]");if(0===o.length)return t.disconnect(),n(".input-group.date").datepicker({format:"dd-mm-yyyy",clearBtn:!1,todayBtn:!0,language:"da"}),n().enableFormValidation("#editAccountingForm"),void n().enableFormValidation("#addPostingLineToPostingJournalForm");n.each(o,function(){n().replaceWithPartialViewFromUrl(this)})}},startAccountPresentation:function(e){var t=n().getPresentAccountingElement();null!==t&&(n(t).data("url",encodeURI(e)),n.each(n(t).parent(),function(){n().startAccountPresentationObserver(this)}),n().replaceWithPartialViewFromUrl(t))},startAccountPresentationObserver:function(e){new MutationObserver(n().accountPresentationCallback).observe(e,{childList:!0})},accountPresentationCallback:function(e,t){if(0!==e.length){var o=n(e[0].target).find("[data-url]");if(0===o.length)return t.disconnect(),void n().enableFormValidation("#editAccountForm");n.each(o,function(){n().replaceWithPartialViewFromUrl(this)})}},startAddingToPostingJournal:function(e,t){n("#addPostingLineToPostingJournalModal").on("shown.bs.modal",function(){n("#addPostingLineToPostingJournalForm").attr("data-accounting-number",e),n("#addPostingLineToPostingJournalForm").attr("data-posting-journal-key",t)}),n("#addPostingLineToPostingJournalModal").modal("show")},addToPostingJournal:function(e,t,o,a,r,i,l,c,u,s,g,d,v){var m=function(e){n().setReadOnly(o,e),n().setDisabled(o,e),n().setReadOnly(a,e),n().setDisabled(a,e),n().setReadOnly(r,e),n().setDisabled(r,e),n().setReadOnly(i,e),n().setDisabled(i,e),n().setReadOnly(l,e),n().setDisabled(l,e),n().setReadOnly(c,e),n().setDisabled(c,e),n().setReadOnly(u,e),n().setDisabled(u,e),n().setReadOnly(s,e),n().setDisabled(s,e),n().setDisabled("#addToPostingJournalButton",e)};m(!0);var f=n("#addPostingLineToPostingJournalForm").validate();if(!1===f.checkForm())return f.showErrors(),void m(!1);var h=n("#addPostingLineToPostingJournalForm").data("accounting-number"),A=n("#addPostingLineToPostingJournalForm").data("posting-journal-key");d=encodeURI(decodeURI(d).replace("{accountingNumber}",h)),v.postingJournalKey=A,v.postingLine=JSON.stringify({Identifier:n().resolveElementValue(t),PostingDate:n().resolvePostingDateAsISOString(o),Reference:n().resolveElementValue(a),AccountNumber:n().resolveAccountNumber(r),Details:n().resolveElementValue(i),BudgetAccountNumber:n().resolveAccountNumber(l),Debit:n().resolvePostingValue(c),Credit:n().resolvePostingValue(u),ContactAccountNumber:n().resolveAccountNumber(s),SortOrder:n().resolveSortOrder(g)}),v.postingJournalHeader=n().resolveElementText(e),n.post(d,v,null,"html").done(function(e){m(!1),n("#addPostingLineToPostingJournalModal").on("hidden.bs.modal",function(){n("#postingJournal").replaceWith(e)}),n("#addPostingLineToPostingJournalModal").modal("hide")}).fail(function(n,e,t){m(!1),null!=t&&0!==t.length&&alert(t)})},removeFromPostingJournal:function(n,e,t,o){alert("OS Debug: removeFromPostingJournal, accountingNumber="+n+", postingJournalKey="+e+", postingLineIdentifier="+t+", postingJournalHeaderElementId="+o)},onPostingDataChange:function(t,o,a,r,i,l,c,u,s,g,d,v,m,f,h){void 0!==e&&clearTimeout(e),e=setTimeout(function(){var e=n("#addPostingLineToPostingJournalForm").data("accounting-number"),A=n().resolvePostingDateAsISOString(t),b=n().resolveAccountNumber(o),P=n().resolveAccountNumber(c),p=n().resolveAccountNumber(v);n().resolveAccount(e,A,b,a,r,i,l),n().resolveBudgetAccount(e,A,P,u,s,g,d),n().resolveContactAccount(e,A,p,m,f,h)},500)},onAccountNumberChange:function(e,o,a,r,i,l){void 0!==t&&clearTimeout(t),t=setTimeout(function(){var t=n("#addPostingLineToPostingJournalForm").data("accounting-number"),c=n().resolvePostingDateAsISOString(e),u=n().resolveAccountNumber(o);n().resolveAccount(t,c,u,a,r,i,l)},500)},resolveAccount:function(e,t,o,a,r,i,l){n(a).val(""),n(r).val(""),n(i).val(""),null!=e&&null!=t&&0!==t.length&&null!=o&&0!==o.length&&(l=encodeURI(decodeURI(l).replace("{accountingNumber}",e).replace("{accountNumber}",o).replace("{statusDate}",t)),n.get(l,null,null,"json").done(function(e){n(a).val(e.accountName),n(r).val(n().currencyFormat(e.valuesAtStatusDate.credit)),n(i).val(n().currencyFormat(e.valuesAtStatusDate.available))}))},onBudgetAccountNumberChange:function(e,t,a,r,i,l){void 0!==o&&clearTimeout(o),o=setTimeout(function(){var o=n("#addPostingLineToPostingJournalForm").data("accounting-number"),c=n().resolvePostingDateAsISOString(e),u=n().resolveAccountNumber(t);n().resolveBudgetAccount(o,c,u,a,r,i,l)},500)},resolveBudgetAccount:function(e,t,o,a,r,i,l){n(a).val(""),n(r).val(""),n(i).val(""),null!=e&&null!=t&&0!==t.length&&null!=o&&0!==o.length&&(l=encodeURI(decodeURI(l).replace("{accountingNumber}",e).replace("{accountNumber}",o).replace("{statusDate}",t)),n.get(l,null,null,"json").done(function(e){n(a).val(e.accountName),n(r).val(n().currencyFormat(e.valuesForMonthOfStatusDate.posted)),n(i).val(n().currencyFormat(e.valuesForMonthOfStatusDate.available))}))},onContactAccountNumberChange:function(e,t,o,r,i){void 0!==a&&clearTimeout(a),a=setTimeout(function(){var a=n("#addPostingLineToPostingJournalForm").data("accounting-number"),l=n().resolvePostingDateAsISOString(e),c=n().resolveAccountNumber(t);n().resolveContactAccount(a,l,c,o,r,i)},500)},resolveContactAccount:function(e,t,o,a,r,i){n(a).val(""),n(r).val(""),null!=e&&null!=t&&0!==t.length&&null!=o&&0!==o.length&&(i=encodeURI(decodeURI(i).replace("{accountingNumber}",e).replace("{accountNumber}",o).replace("{statusDate}",t)),n.get(i,null,null,"json").done(function(e){n(a).val(e.accountName),n(r).val(n().currencyFormat(e.valuesAtStatusDate.balance))}))},resolvePostingDateAsISOString:function(e){var t=n().resolvePostingDate(e);return null==t?null:t.toISOString()},resolvePostingDate:function(e){var t=n().resolveElementValue(e);return null==t||0===t.length?null:new RegExp("^(0[1-9]|[12][0-9]|3[01])-(0[1-9]|1[012])-((19|20)[0-9]{2})$").test(t)?new Date(t.substr(6,4),t.substr(3,2)-1,t.substr(0,2)):null},resolveAccountNumber:function(e){var t=n().resolveElementValue(e);return null==t||0===t.length?null:t.toUpperCase()},resolvePostingValue:function(e){var t=n().resolveElementValue(e);if(null==t||0===t.length)return null;var o=(t=t.trim()).replace(/[^0-9]/g,"");return/[,\.]\d{2}$/.test(t)&&(o=o.replace(/(\d{2})$/,".$1")),parseFloat(parseFloat(o).toFixed(2))},resolveSortOrder:function(e){var t=n().resolveElementValue(e);return null==t||0===t.length?null:parseInt(t)},resolveElementValue:function(e){var t=n(e).val();return null==t||0===t.length?null:t},resolveElementText:function(e){var t=n(e).text();return null==t||0===t.length?null:t},currencyFormat:function(n){return"kr. "+n.toFixed(2).replace(".",",").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1.")}}),n(document).ready(function(){n().startAccountingCollectionObserver(document.getElementById("accountingCollection"));var e=n().getUrlForDefaultAccountingNumber();null!==e&&(n().isRightContentHidden()||n().getAccounting(e))})}(jQuery);