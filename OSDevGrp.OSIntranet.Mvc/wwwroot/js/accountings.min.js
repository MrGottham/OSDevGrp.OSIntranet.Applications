!function(n){n.fn.extend({getDefaultAccountingNumber:function(){var t=n("#accountingOperations").find("#DefaultAccountingNumber").val();return null==t||0===t.length?null:parseInt(t)},getUrlForDefaultAccountingNumber:function(){var t=n("#accountingOperations").find("#DefaultAccountingNumber").parent().data("url");return null==t||0===t.length?null:t},getActiveAccountingNumber:function(){var t=n("#loadedAccountingCollection").children("[data-accounting-number]");if(0===t.length)return null;var e=null;return n.each(t,function(){n(this).hasClass("active")&&null===e&&(e=parseInt(n(this).data("accounting-number")))}),e},getActiveOrDefaultAccountingNumber:function(){var t=n().getActiveAccountingNumber();return null!=t?t:n().getDefaultAccountingNumber()},newAccounting:function(t){var e=n().getPresentAccountingElement();null!==e&&(n(e).data("url",encodeURI(t)),n.each(n(e).parent(),function(){n().startPresentingAccountingObserver(this)}),n().replaceWithPartialViewFromUrl(e))},getAccounting:function(t){var e=n().getPresentAccountingElement();null!==e&&(n(e).data("url",encodeURI(t)),n.each(n(e).parent(),function(){n().startPresentingAccountingObserver(this)}),n().replaceWithPartialViewFromUrl(e))},editAccounting:function(){n().isDisplayed("#editAccounting")||(n().toggleDisplay("#presentAccounting"),n().toggleDisplay("#editAccounting"))},cancelEditAccounting:function(){0!==n("#editAccounting").length?!1!==n().isDisplayed("#editAccounting")&&(n().toggleDisplay("#editAccounting"),n().toggleDisplay("#presentAccounting")):n("#editAccountingForm").remove()},refreshAccountings:function(t){if(0!==n("#loadedAccountingCollection").length){var e=n().getActiveOrDefaultAccountingNumber(),i=decodeURI(t);i=null==e?i.substr(0,i.indexOf("?")):i.replace("{accountingNumber}",e),n().startLoadingAccountings(encodeURI(i))}},startLoadingAccountings:function(t){n.each(n("#accountingCollection"),function(){n().startAccountingCollectionObserver(this),n.each(n(this).children("#loadedAccountingCollection"),function(){n(this).data("url",t),n().replaceWithPartialViewFromUrl(this)})})},startAccountingCollectionObserver:function(t){new MutationObserver(n().accountingCollectionCallback).observe(t,{childList:!0})},accountingCollectionCallback:function(t,e){if(0!==t.length){var i=n(t[0].target).find("#loadedAccountingCollection");if(0!==i.length){e.disconnect();var c=n().isRightContentHidden();n.each(i,function(){n.each(n(this).find("a"),function(){!0===c&&n(this).hasClass("active")&&n(this).removeClass("active"),n(this).on("click",function(t){t.preventDefault(),n(this).tab("show")}),n(this).on("shown.bs.tab",function(t){n().getAccounting(n(t.target).data("url"))})})})}else n().handleUrlInstantLoading(n(document))}},isRightContentHidden:function(){return n("#rightContent").is(":hidden")},getPresentAccountingElement:function(){var t=n("#rightContent");t.is(":hidden")&&(t=n("#leftContent"));var e=null,i=0;return n.each(n(t).children("div"),function(){0===i?(e=n(this),i++):n(this).remove()}),e},startPresentingAccountingObserver:function(t){new MutationObserver(n().presentingAccountingCallback).observe(t,{childList:!0})},presentingAccountingCallback:function(t,e){if(0!==t.length){var i=n(t[0].target).find("[data-url]");if(0===i.length)return e.disconnect(),void n().enableFormValidation("#editAccountingForm");n.each(i,function(){n().replaceWithPartialViewFromUrl(this)})}}}),n(document).ready(function(){n().startAccountingCollectionObserver(document.getElementById("accountingCollection"));var t=n().getUrlForDefaultAccountingNumber();null!==t&&(n().isRightContentHidden()||n().getAccounting(t))})}(jQuery);